{% extends "base.html" %}

{% block title %}Bestellung{% endblock %}

{% block head %}
{% endblock %}

{% block content %}
  <div class="container my-5">
    <h2>Bestellung #{{order.id}} bei Sangam</h2>

    <dl class="row">
      <dt class="col-sm-2">Status:</dt>
      <dd class="col-sm-10">{{order.state}}</dd>

      {% match order.eta %}
        {% when Some with (eta) %}
          <dt class="col-sm-2">Bestellschluss:</dt>
          <dd class="col-sm-10">19:00 Uhr</dd>
        {% when None %}
      {% endmatch %}

      <dt class="col-sm-2">Gestartet von:</dt>
      <dd class="col-sm-10">{{order.initiator.name}}</dd>
    </dl>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th>Benutzer</th>
            <th>Artikelnummer</th>
            <th>Name</th>
            <th>Preis</th>
            <th>Gesamtpreis</th>
          </tr>
        </thead>
        <tbody>
        {% for item in grouped_items %}
          <tr class="table-group-divider">
            <td></td>
            <th scope="row" colspan="4">{{item.0.name}}</th>
            <td>{{"{},{:2}€"|format(item.1 / 100, item.1 % 100)}}</td>
          </tr>
          {% for order_item in item.2 %}
            <tr>
              <tbody>
                <tr>
                  <th scope="row" colspan="2">{{order_item.id}}</th>
                  <td>{{order_item.menu_item.short_name}}</td>
                  <td>{{order_item.menu_item.name}}</td>
                  <td colspan="2">{{"{},{:2}€"|format(order_item.menu_item.price / 100, order_item.menu_item.price % 100)}}</td>
                </tr>
              </tbody>
            </tr>
          {% endfor %}
        {% endfor %}
        </tbody>
        <tfoot class="table-group-divider">
          <tr>
            <th scope="row" colspan="5">Anzahl: {{order.items.len()}}</th>
            <td>{{"{},{:2}€"|format(price_total / 100, price_total % 100)}}</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
{% endblock %}


